'use strict';var J6={TAB:0,tg:1,pj:2},K6=function(a){ib("MediaRouter.WebRtc.Start.Success",a,J6)};var O6=function(a,b){ig.call(this,b);this.s=a;this.a=new kb;this.h=Nr(b.id);this.g=new kb;this.v=!1;this.l=null;this.u=!1;this.m=this.f=null;L6(this);M6(this);N6(this,new pg("GET_TURN_CREDENTIALS"))};qa(O6,ig);O6.prototype.start=function(a){var b=this;return this.a.a.then(function(c){if(c.b)return Promise.reject(new vf("Mirroring already started"));if(b.l)return Promise.reject(new vf("Session permanently stopped"));b.f=new Ya("MediaRouter.WebRtc.Session.Launch");c.a.addStream(a);c.start();return b.g.a})};
O6.prototype.stop=function(){var a=this;this.g.reject(new vf("Session stop requested."));this.m&&(this.m.a(),this.m=null);if(this.l)return this.l;this.u=this.v=!1;this.f=null;return this.l=this.a.a.then(function(a){a.stop()}).then(function(){return a.h.va()}).catch(function(b){a.h.va();throw b;})};
var L6=function(a){a.h.onMessage=function(b){if(!b.type)throw Error("Message has no type.");switch(b.type){case "TURN_CREDENTIALS":a.a.resolve(new ug(a.b.id,b.data.credentials));break;case "ANSWER":a.a.a.then(function(a){Cg(a,b.data)});break;case "KNOCK_ANSWER":a.u=!0;a.a.a.then(function(a){Cg(a,b.data)});break;case "STOP":a.g.reject(new vf("Stop signal received"));a.stop();break;default:throw new vf("Unknown message type: "+b.type);}}},M6=function(a){a.a.a.then(function(b){yg(b,function(b){N6(a,
new pg("OFFER",new rg(b,a.s,sg)))});zg(b,function(b){N6(a,qg(b))});vg(b,function(){a.v=!0;N6(a,new pg("SESSION_START_SUCCESS"));!a.u&&a.f&&a.f.a();a.f=null;a.m=new db("MediaRouter.WebRtc.Session.Length");a.g.resolve(a)});xg(b,function(){N6(a,new pg("SESSION_END"))});wg(b,function(b){a.v||a.g.reject(b);N6(a,new pg("SESSION_FAILURE"))})})},N6=function(a,b){a.h.sendMessage(b,P6)},P6={channelType:"cloud"};var Q6=function(){Zf.call(this,"webrtc")};qa(Q6,Zf);g=Q6.prototype;g.ve=function(a,b){return new O6(a,b)};g.Xe=function(){K6(0)};g.Ue=function(){K6(1)};g.Yf=function(){K6(2)};g.Ve=function(){hb("MediaRouter.WebRtc.Session.End")};g.We=function(a){ib("MediaRouter.WebRtc.Start.Failure",a,uf)};g.Td=function(){hb("MediaRouter.WebRtc.Stream.End")};var R6=new Q6;Yf("mr.mirror.webrtc.WebRtcService",R6);
